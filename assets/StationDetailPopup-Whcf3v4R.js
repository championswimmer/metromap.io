import{C as h,N as m,T as u,S as W,L as n,F as $,G as y,e as f}from"./index-C-tHju-3.js";const L={color:16777215,width:350,height:600,shadow:!0,shadowColor:10526880,shadowOffset:22};class T extends h{image;shadow;constructor(s={}){super();const t={...L,...s};this.image=new m({texture:u.from("rounded-rectangle.png"),leftWidth:34,topHeight:34,rightWidth:34,bottomHeight:34,width:t.width,height:t.height,tint:t.color}),this.image.x=-this.image.width*.5,this.image.y=-this.image.height*.5,this.addChild(this.image),t.shadow&&(this.shadow=new m({texture:u.from("rounded-rectangle.png"),leftWidth:34,topHeight:34,rightWidth:34,bottomHeight:34,width:t.width,height:t.height,tint:t.shadowColor}),this.shadow.x=-this.shadow.width*.5,this.shadow.y=-this.shadow.height*.5+t.shadowOffset,this.addChildAt(this.shadow,0))}get boxWidth(){return this.image.width}get boxHeight(){return this.image.height}}let C=null,B=[];function P(l,s){C=l,B=s}class v extends h{bg;panel;panelBase;title;closeButton;tableContainer;station;constructor(){if(super(),!C)throw new Error("Station not set for popup");this.station=C,this.bg=new W(u.WHITE),this.bg.tint=0,this.bg.alpha=.7,this.bg.interactive=!0,this.bg.on("pointertap",()=>this.close()),this.addChild(this.bg),this.panel=new h,this.addChild(this.panel),this.panelBase=new T({width:500,height:400,color:2899536}),this.panel.addChild(this.panelBase),this.title=new n({text:`Station ${this.station.label}`,style:{fill:16777215,fontSize:32,fontWeight:"bold"}}),this.title.anchor.set(.5),this.title.y=-this.panelBase.boxHeight*.5+40,this.panel.addChild(this.title);const s=this.station.passengers.length,t=new n({text:`${s} passenger${s!==1?"s":""} waiting`,style:{fill:11184810,fontSize:18}});t.anchor.set(.5),t.y=-this.panelBase.boxHeight*.5+75,this.panel.addChild(t),this.tableContainer=new h,this.tableContainer.y=-this.panelBase.boxHeight*.5+110,this.panel.addChild(this.tableContainer),this.renderTable(),this.closeButton=new $({text:"Close",width:120,height:45,fontSize:18,backgroundColor:3447003}),this.closeButton.y=this.panelBase.boxHeight*.5-60,this.closeButton.onPress.connect(()=>this.close()),this.panel.addChild(this.closeButton)}renderTable(){const s=new Map;for(const e of this.station.passengers){const i=e.destinationStationId;s.set(i,(s.get(i)||0)+1)}const t=Array.from(s.entries()).map(([e,i])=>({stationId:e,count:i}));t.sort((e,i)=>i.count-e.count);const a=0,d=new y;d.rect(-220,a,440,35),d.fill(3426654),this.tableContainer.addChild(d);const r=new n({text:"Destination",style:{fill:16777215,fontSize:16,fontWeight:"bold"}});r.anchor.set(0,.5),r.position.set(-210,a+17),this.tableContainer.addChild(r);const g=new n({text:"Passengers",style:{fill:16777215,fontSize:16,fontWeight:"bold"}});g.anchor.set(1,.5),g.position.set(210,a+17),this.tableContainer.addChild(g);let o=a+35;const c=8,x=t.slice(0,c);for(let e=0;e<x.length;e++){const i=x[e],S=B.find(z=>z.id===i.stationId),H=S?`Station ${i.stationId} (${S.label})`:`Station ${i.stationId}`,p=new y;p.rect(-220,o,440,30),p.fill(e%2===0?2899536:3426654),this.tableContainer.addChild(p);const w=new n({text:H,style:{fill:15528177,fontSize:14}});w.anchor.set(0,.5),w.position.set(-210,o+15),this.tableContainer.addChild(w);const b=new n({text:i.count.toString(),style:{fill:3447003,fontSize:14,fontWeight:"bold"}});b.anchor.set(1,.5),b.position.set(210,o+15),this.tableContainer.addChild(b),o+=30}if(t.length>c){const e=t.length-c,i=new n({text:`... and ${e} more destination${e!==1?"s":""}`,style:{fill:9807270,fontSize:12,fontStyle:"italic"}});i.anchor.set(.5,0),i.position.set(0,o+5),this.tableContainer.addChild(i)}if(t.length===0){const e=new n({text:"No passengers waiting",style:{fill:8359053,fontSize:16,fontStyle:"italic"}});e.anchor.set(.5,0),e.position.set(0,20),this.tableContainer.addChild(e)}}close(){f().navigation.dismissPopup()}async show(){this.resize()}resize(){const s=f().renderer.width,t=f().renderer.height;this.bg.width=s,this.bg.height=t,this.panel.x=s/2,this.panel.y=t/2}}export{v as StationDetailPopup,P as setStationForPopup};
